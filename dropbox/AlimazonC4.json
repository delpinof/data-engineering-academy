{"paragraphs":[{"text":"import org.apache.spark.sql.types.{StructType, StringType, TimestampType, IntegerType, DoubleType}\r\nimport org.apache.spark.sql.{Dataset,Row,SaveMode}\r\nimport java.util.Calendar\r\nimport java.sql.Timestamp\r\n\r\nval schema = (new StructType).add(\"id\", StringType).add(\"client_id\",StringType).add(\"timestamp\", TimestampType).add(\"product_id\",StringType).add(\"quantity\",IntegerType).add(\"total\",DoubleType)\r\nval orders = spark.read.schema(schema).json(\"gs://de-training-input/alimazon/200000/client-orders/part_20180820T15465*.jsonl.gz\")\r\norders.createOrReplaceTempView(\"orders\")\r\n\r\ndef saveToFile(ds:Dataset[Row],filename:String) = {\r\n            ds.write.mode(SaveMode.Overwrite)\r\n        \t   .format(\"com.databricks.spark.csv\")\r\n        \t   .option(\"header\", true)\r\n        \t   .option(\"delimiter\", \",\")\r\n        \t   .save(s\"gs://de-training-output-fherdelpino/assignment-4/$filename\")\r\n}","user":"anonymous","dateUpdated":"2018-08-26T02:12:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535239335742_-665960177","id":"20180825-232215_1575386027","dateCreated":"2018-08-25T23:22:15+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3273"},{"text":"val best_selling_hours = spark.sql(\"select hour(timestamp) as hour, bround(avg(total),2) average_spending, min(total) min_spending, max(total) max_spending from orders group by hour order by average_spending\")","user":"anonymous","dateUpdated":"2018-08-26T01:31:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"best_selling_hours: org.apache.spark.sql.DataFrame = [hour: int, average_spending: double ... 2 more fields]\n+----+----------------+------------+------------+\n|hour|average_spending|min_spending|max_spending|\n+----+----------------+------------+------------+\n|  12|         1618.03|        2.64|    63223.38|\n|   5|         1619.44|        3.49|     64882.7|\n|  19|         1620.04|        3.28|    56860.65|\n|   0|         1633.44|        1.66|    57238.95|\n|  11|         1635.69|        2.57|     34711.6|\n|   4|         1636.94|        1.75|    51451.92|\n|  21|         1637.28|        1.41|    42634.61|\n|  16|         1640.87|        1.74|    60273.05|\n|  10|         1652.34|        1.75|     48121.5|\n|  13|         1654.69|        1.65|    38773.35|\n|   7|         1657.29|        1.53|    46268.95|\n|  14|         1659.12|        2.92|    61855.05|\n|   9|         1664.37|        2.19|    43729.74|\n|  17|         1666.42|        2.19|    52087.06|\n|   6|         1666.46|        2.78|    30723.32|\n|   2|         1671.12|        2.24|    43087.11|\n|   8|         1674.61|        2.65|    62375.76|\n|  22|         1677.87|        2.31|    56507.52|\n|  20|         1679.02|        3.06|    38906.77|\n|   1|         1687.57|        2.41|    52952.34|\n+----+----------------+------------+------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1535239663309_929869347","id":"20180825-232743_1587521047","dateCreated":"2018-08-25T23:27:43+0000","dateStarted":"2018-08-25T23:54:52+0000","dateFinished":"2018-08-25T23:54:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3274"},{"text":"saveToFile(best_selling_hours,\"assignment-4-best_selling_hours-1\")","user":"anonymous","dateUpdated":"2018-08-26T01:59:34+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535239866101_-238538087","id":"20180825-233106_1901477366","dateCreated":"2018-08-25T23:31:06+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3275"},{"text":"val monthly_sales = spark.sql(\"select product_id, sum(quantity) total_products_sold, sum(total) total_registered_sales from orders where months_between(current_date,timestamp) <= 6 group by product_id order by total_products_sold desc limit 10\")\n\nval monthly_disscount = monthly_sales\n                            .withColumn(\"unit_product_price\",bround($\"total_registered_sales\"/$\"total_products_sold\",2))\n                            .withColumn(\"new_unit_product_price\",bround($\"unit_product_price\"*0.9,2))","user":"anonymous","dateUpdated":"2018-08-26T02:12:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"monthly_sales: org.apache.spark.sql.DataFrame = [product_id: string, total_products_sold: bigint ... 1 more field]\n+----------+-------------------+----------------------+------------------+----------------------+\n|product_id|total_products_sold|total_registered_sales|unit_product_price|new_unit_product_price|\n+----------+-------------------+----------------------+------------------+----------------------+\n|B0041JFLHS|                277|    21266.219999999998|             76.77|                 69.09|\n|B00HF4VBWU|                277|               3125.11|             11.28|                 10.15|\n|B00FXJ7NJE|                276|               2571.15|              9.32|                  8.39|\n|0590228544|                274|               6373.43|             23.26|                 20.93|\n|B00AF8SN42|                271|               9143.69|             33.74|                 30.37|\n|B005N7YS4O|                259|               6204.17|             23.95|                 21.56|\n|B007XK2QRU|                253|               9314.23|             36.82|                 33.14|\n|B0033UWT7G|                244|               6242.36|             25.58|                 23.02|\n|B009143ZOO|                244|               4552.26|             18.66|                 16.79|\n|B00V4QQMM4|                242|               5941.54|             24.55|                  22.1|\n+----------+-------------------+----------------------+------------------+----------------------+\n\nmonthly_disscount: Unit = ()\n"}]},"apps":[],"jobName":"paragraph_1535241176637_-2053144715","id":"20180825-235256_1541592725","dateCreated":"2018-08-25T23:52:56+0000","dateStarted":"2018-08-26T02:09:56+0000","dateFinished":"2018-08-26T02:10:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3276"},{"text":"saveToFile(monthly_disscount,\"assignment-4-monthly_disscount-1\")","user":"anonymous","dateUpdated":"2018-08-26T01:32:40+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535241361021_-13546468","id":"20180825-235601_1154142976","dateCreated":"2018-08-25T23:56:01+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3277"},{"text":"val client_products = spark.sql(\"select client_id, sum(quantity) products_count from orders group by client_id\")\n\nval client_orders_dist = client_products.groupBy(\"products_count\").count().withColumnRenamed(\"count\",\"clients_count\").orderBy($\"clients_count\")","user":"anonymous","dateUpdated":"2018-08-26T02:08:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"client_products: org.apache.spark.sql.DataFrame = [client_id: string, products_count: bigint]\n+--------------+-------------+\n|products_count|clients_count|\n+--------------+-------------+\n|         18852|            1|\n|         18739|            1|\n|         18527|            1|\n|         18386|            1|\n|         18271|            1|\n|         17997|            1|\n|         17971|            1|\n|         17902|            1|\n|         17859|            1|\n|         17802|            1|\n|         17705|            1|\n|         17690|            1|\n|         17670|            1|\n|         17660|            1|\n|         17593|            1|\n|         17528|            1|\n|         17496|            1|\n|         17479|            1|\n|         17476|            1|\n|         17456|            1|\n+--------------+-------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1535244755695_1178892709","id":"20180826-005235_876980668","dateCreated":"2018-08-26T00:52:35+0000","dateStarted":"2018-08-26T01:09:40+0000","dateFinished":"2018-08-26T01:09:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3278"},{"text":"saveToFile(client_orders_dist,\"assignment-4-client_orders_dist-1\")","user":"anonymous","dateUpdated":"2018-08-26T01:34:54+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535245310864_-1716422150","id":"20180826-010150_556706309","dateCreated":"2018-08-26T01:01:50+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3279"}],"name":"AlimazonC4","id":"2DP78XEVX","angularObjects":{"2DR5Q8TJ5:shared_process":[],"2DQQXSRX8:shared_process":[],"2DQXA95DU:shared_process":[],"2DR3YZ32M:shared_process":[],"2DQXS8RSE:shared_process":[],"2DNFJK5RN:shared_process":[],"2DQE6R3D1:shared_process":[],"2DQ421M5M:shared_process":[],"2DQC97UR5:shared_process":[],"2DPWM6BMV:shared_process":[],"2DRJ1CVY3:shared_process":[],"2DRC7CJYM:shared_process":[],"2DPA8RCGR:shared_process":[],"2DQ9T9QJN:shared_process":[],"2DNP9NB9W:shared_process":[],"2DRFT985Y:shared_process":[],"2DNCJMR22:shared_process":[],"2DPFEEPT9:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}