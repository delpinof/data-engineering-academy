{"paragraphs":[{"text":"import org.apache.spark.sql.types.{StructType, StringType, TimestampType, IntegerType, DoubleType}\r\nimport org.apache.spark.sql.{Dataset,Row,SaveMode}\r\nimport java.util.Calendar\r\nimport java.sql.Timestamp","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types.{StructType, StringType, TimestampType, IntegerType, DoubleType}\nimport org.apache.spark.sql.{Dataset, Row, SaveMode}\nimport java.util.Calendar\nimport java.sql.Timestamp\n"}]},"apps":[],"jobName":"paragraph_1535221464853_-1074598117","id":"20180823-215051_604883637","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:12+0000","dateFinished":"2018-08-25T21:06:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5696"},{"text":"val schema = (new StructType).add(\"id\", StringType).add(\"client_id\",StringType).add(\"timestamp\", TimestampType).add(\"product_id\",StringType).add(\"quantity\",IntegerType).add(\"total\",DoubleType)","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"schema: org.apache.spark.sql.types.StructType = StructType(StructField(id,StringType,true), StructField(client_id,StringType,true), StructField(timestamp,TimestampType,true), StructField(product_id,StringType,true), StructField(quantity,IntegerType,true), StructField(total,DoubleType,true))\n"}]},"apps":[],"jobName":"paragraph_1535221464853_-1074598117","id":"20180823-215128_1923489240","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:12+0000","dateFinished":"2018-08-25T21:06:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5697"},{"text":"val orders = spark.read.schema(schema).json(\"gs://de-training-input/alimazon/200000/client-orders/part_20180820T15465*.jsonl.gz\")","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"orders: org.apache.spark.sql.DataFrame = [id: string, client_id: string ... 4 more fields]\n"}]},"apps":[],"jobName":"paragraph_1535221464854_-1073443871","id":"20180823-215150_996298665","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:12+0000","dateFinished":"2018-08-25T21:06:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5698"},{"text":"orders.createOrReplaceTempView(\"orders\")","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1535221464854_-1073443871","id":"20180823-215218_1239351281","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:13+0000","dateFinished":"2018-08-25T21:06:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5699"},{"text":"spark.udf.register(\"dayofweek\", (input: Timestamp) => {\r\n            val cal = Calendar.getInstance()\r\n            cal.setTime(input)\r\n            cal.get(Calendar.DAY_OF_WEEK)\r\n        })","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res499: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,IntegerType,Some(List(TimestampType)))\n"}]},"apps":[],"jobName":"paragraph_1535221464854_-1073443871","id":"20180823-215228_1012893533","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:14+0000","dateFinished":"2018-08-25T21:06:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5700"},{"text":"//Function to save to a file in CVS format\r\ndef saveToFile(ds:Dataset[Row],filename:String) = {\r\n            ds.write.mode(SaveMode.Overwrite)\r\n        \t   .format(\"com.databricks.spark.csv\")\r\n        \t   .option(\"header\", true)\r\n        \t   .option(\"delimiter\", \",\")\r\n        \t   .save(s\"gs://de-training-output-fherdelpino/assignment-3-tst/$filename\")\r\n}","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"saveToFile: (ds: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row], filename: String)Unit\n"}]},"apps":[],"jobName":"paragraph_1535221464854_-1073443871","id":"20180823-215445_1056023175","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:15+0000","dateFinished":"2018-08-25T21:06:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5701"},{"text":"val productWeek1 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 1 group by product_id\")\nval productWeek2 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 2 group by product_id\")\nval productWeek3 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 3 group by product_id\")\nval productWeek4 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 4 group by product_id\")\nval productWeek5 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 5 group by product_id\")\nval productWeek6 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 6 group by product_id\")\nval productWeek7 = spark.sql(\"select product_id, sum(total) gross_sales, count(id) orders_count from orders where dayofweek(timestamp) = 7 group by product_id\")","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"productWeek1: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek2: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek3: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek4: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek5: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek6: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\nproductWeek7: org.apache.spark.sql.DataFrame = [product_id: string, gross_sales: double ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1535221464854_-1073443871","id":"20180823-215242_93760460","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:15+0000","dateFinished":"2018-08-25T21:06:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5702"},{"text":"productWeek1.cache()\nproductWeek2.cache()\nproductWeek3.cache()\nproductWeek4.cache()\nproductWeek5.cache()\nproductWeek6.cache()\nproductWeek7.cache()","user":"anonymous","dateUpdated":"2018-08-25T21:05:40+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535230853477_-172504348","id":"20180825-210053_1983615683","dateCreated":"2018-08-25T21:00:53+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:5703"},{"text":"val productMonth1 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 1 group by client_id\")\nval productMonth2 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 2 group by client_id\")\nval productMonth3 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 3 group by client_id\")\nval productMonth4 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 4 group by client_id\")\nval productMonth5 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 5 group by client_id\")\nval productMonth6 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 6 group by client_id\")\nval productMonth7 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 7 group by client_id\")\nval productMonth8 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 8 group by client_id\")\nval productMonth9 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 9 group by client_id\")\nval productMonth10 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 10 group by client_id\")\nval productMonth11 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 11 group by client_id\")\nval productMonth12 = spark.sql(\"select client_id, sum(total) gross_sales, count(id) orders_count from orders where month(timestamp) = 12 group by client_id\")","user":"anonymous","dateUpdated":"2018-08-25T21:06:16+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"productMonth1: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth2: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth3: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth4: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth5: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth6: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth7: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth8: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth9: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth10: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth11: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\nproductMonth12: org.apache.spark.sql.DataFrame = [client_id: string, gross_sales: double ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1535229133348_-2052086447","id":"20180825-203213_1276073415","dateCreated":"2018-08-25T20:32:13+0000","dateStarted":"2018-08-25T21:06:16+0000","dateFinished":"2018-08-25T21:06:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5704"},{"text":"productMonth1.cache()\nproductMonth2.cache()\nproductMonth3.cache()\nproductMonth4.cache()\nproductMonth5.cache()\nproductMonth6.cache()\nproductMonth7.cache()\nproductMonth8.cache()\nproductMonth9.cache()\nproductMonth10.cache()\nproductMonth11.cache()\nproductMonth12.cache()","user":"anonymous","dateUpdated":"2018-08-25T21:05:46+0000","config":{"colWidth":12,"enabled":false,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535230814493_-765078951","id":"20180825-210014_1120479096","dateCreated":"2018-08-25T21:00:14+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:5705"},{"text":"saveToFile(\n        productWeek1.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_1\"\n)\nsaveToFile(\n        productWeek2.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_2\"\n)\nsaveToFile(\n        productWeek3.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_3\"\n)\nsaveToFile(\n        productWeek4.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_4\"\n)\nsaveToFile(\n        productWeek5.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_5\"\n)\nsaveToFile(\n        productWeek6.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_6\"\n)\nsaveToFile(\n        productWeek7.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_products_by_gross_sales_7\"\n)","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1535221464855_-1073828620","id":"20180823-220058_1314901098","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:06:16+0000","dateFinished":"2018-08-25T21:07:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5706"},{"text":"saveToFile(\n        productWeek1.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_1\"\n)\nsaveToFile(\n        productWeek2.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_2\"\n)\nsaveToFile(\n        productWeek3.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_3\"\n)\nsaveToFile(\n        productWeek4.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_4\"\n)\nsaveToFile(\n        productWeek5.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_5\"\n)\nsaveToFile(\n        productWeek6.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_6\"\n)\nsaveToFile(\n        productWeek7.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_products_by_orders_7\"\n)","user":"anonymous","dateUpdated":"2018-08-25T21:06:18+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1535228529593_1307282082","id":"20180825-202209_1857997256","dateCreated":"2018-08-25T20:22:09+0000","dateStarted":"2018-08-25T21:06:18+0000","dateFinished":"2018-08-25T21:08:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5707"},{"text":"saveToFile(\n        productMonth1.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_1\"\n)\nsaveToFile(\n        productMonth2.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_2\"\n)\nsaveToFile(\n        productMonth3.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_3\"\n)\nsaveToFile(\n        productMonth4.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_4\"\n)\nsaveToFile(\n        productMonth5.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_5\"\n)\nsaveToFile(\n        productMonth6.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_6\"\n)\nsaveToFile(\n        productMonth7.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_7\"\n)\nsaveToFile(\n        productMonth8.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_8\"\n)\nsaveToFile(\n        productMonth9.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_9\"\n)\nsaveToFile(\n        productMonth10.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_10\"\n)\nsaveToFile(\n        productMonth11.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_11\"\n)\nsaveToFile(\n        productMonth12.orderBy($\"gross_sales\".desc).limit(10),\n        \"top10_customers_by_gross_spending_12\"\n)","user":"anonymous","dateUpdated":"2018-08-25T21:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1535221464860_-1077291360","id":"20180823-221447_635543967","dateCreated":"2018-08-25T18:24:24+0000","dateStarted":"2018-08-25T21:07:12+0000","dateFinished":"2018-08-25T21:08:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5708"},{"text":"saveToFile(\n        productMonth1.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_1\"\n)\nsaveToFile(\n        productMonth2.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_2\"\n)\nsaveToFile(\n        productMonth3.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_3\"\n)\nsaveToFile(\n        productMonth4.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_4\"\n)\nsaveToFile(\n        productMonth5.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_5\"\n)\nsaveToFile(\n        productMonth6.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_6\"\n)\nsaveToFile(\n        productMonth7.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_7\"\n)\nsaveToFile(\n        productMonth8.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_8\"\n)\nsaveToFile(\n        productMonth9.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_9\"\n)\nsaveToFile(\n        productMonth10.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_10\"\n)\nsaveToFile(\n        productMonth11.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_11\"\n)\nsaveToFile(\n        productMonth12.orderBy($\"orders_count\".desc).limit(10),\n        \"top10_customers_by_orders_12\"\n)","user":"anonymous","dateUpdated":"2018-08-25T21:08:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1535230570958_-467808136","id":"20180825-205610_2126603089","dateCreated":"2018-08-25T20:56:10+0000","dateStarted":"2018-08-25T21:08:03+0000","dateFinished":"2018-08-25T21:09:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5709"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535230705258_-817975084","id":"20180825-205825_2100153240","dateCreated":"2018-08-25T20:58:25+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:5710"}],"name":"AlimazonC3v2","id":"2DMT72END","angularObjects":{"2DR5Q8TJ5:shared_process":[],"2DQQXSRX8:shared_process":[],"2DQXA95DU:shared_process":[],"2DR3YZ32M:shared_process":[],"2DQXS8RSE:shared_process":[],"2DNFJK5RN:shared_process":[],"2DQE6R3D1:shared_process":[],"2DQ421M5M:shared_process":[],"2DQC97UR5:shared_process":[],"2DPWM6BMV:shared_process":[],"2DRJ1CVY3:shared_process":[],"2DRC7CJYM:shared_process":[],"2DPA8RCGR:shared_process":[],"2DQ9T9QJN:shared_process":[],"2DNP9NB9W:shared_process":[],"2DRFT985Y:shared_process":[],"2DNCJMR22:shared_process":[],"2DPFEEPT9:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}