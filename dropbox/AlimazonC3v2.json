{"paragraphs":[{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061051493_619907030","id":"20180823-215051_604883637","dateCreated":"2018-08-23T21:50:51+0000","status":"PENDING","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:324","text":"import org.apache.spark.sql.types.{StructType, StringType, TimestampType, IntegerType, DoubleType}\r\nimport java.util.Calendar\r\nimport java.sql.Timestamp","dateUpdated":"2018-08-23T21:51:35+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061088165_156916186","id":"20180823-215128_1923489240","dateCreated":"2018-08-23T21:51:28+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:388","text":"val schema = (new StructType).add(\"id\", StringType).add(\"client_id\",StringType).add(\"timestamp\", TimestampType).add(\"product_id\",StringType).add(\"quantity\",IntegerType).add(\"total\",DoubleType)","dateUpdated":"2018-08-23T21:51:33+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061110998_-221261335","id":"20180823-215150_996298665","dateCreated":"2018-08-23T21:51:50+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:460","text":"val orders = spark.read.schema(schema).json(\"gs://de-training-input/alimazon/200000/client-orders/part_20180820T154648_00000.jsonl.gz\")","dateUpdated":"2018-08-23T21:52:07+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061138430_-1522635356","id":"20180823-215218_1239351281","dateCreated":"2018-08-23T21:52:18+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:519","text":"orders.createOrReplaceTempView(\"orders\")","dateUpdated":"2018-08-23T21:52:19+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061148988_-1822708850","id":"20180823-215228_1012893533","dateCreated":"2018-08-23T21:52:28+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:582","text":"spark.udf.register(\"dayofweek\", (input: Timestamp) => {\r\n            val cal = Calendar.getInstance()\r\n            cal.setTime(input)\r\n            cal.get(Calendar.DAY_OF_WEEK)\r\n        })","dateUpdated":"2018-08-23T21:52:30+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061285762_-166597987","id":"20180823-215445_1056023175","dateCreated":"2018-08-23T21:54:45+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:710","text":"//Function to save to a file in CVS format\r\ndef saveToFile(ds:Dataset[Row],filename:String) = {\r\n            ds.write\r\n        \t   .format(\"com.databricks.spark.csv\")\r\n        \t   .option(\"header\", true)\r\n        \t   .option(\"delimiter\", \",\")\r\n        \t   .save(s\"gs://de-training-output-fherdelpino/assignment-3-tst6/$filename\")\r\n}","dateUpdated":"2018-08-23T22:15:51+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061162516_1798178373","id":"20180823-215242_93760460","dateCreated":"2018-08-23T21:52:42+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:651","text":"val productGrossSalesQuery = n=>s\"select product_id,sum(total) gross_sales from orders where dayofweek(timestamp) = $n group by product_id order by gross_sales desc limit 10\"","dateUpdated":"2018-08-23T22:01:14+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061658456_1304465624","id":"20180823-220058_1314901098","dateCreated":"2018-08-23T22:00:58+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:906","text":"for (i <- 1 to 7)\n    saveToFile(\n            spark.sql(productGrossSalesQuery(i.toString)),\n            s\"top10_products_by_gross_sales_$i\"\n        )","dateUpdated":"2018-08-23T22:01:08+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061465079_-1037191158","id":"20180823-215745_260693814","dateCreated":"2018-08-23T21:57:45+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:775","text":"val productOrdersQuery = n=>s\"select product_id,count(id) orders_count from orders where dayofweek(timestamp) = $n group by product_id order by orders_count desc limit 10\"","dateUpdated":"2018-08-23T22:00:26+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535061627009_-1201281369","id":"20180823-220027_228388631","dateCreated":"2018-08-23T22:00:27+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:846","text":"for (i <- 1 to 7)\n    saveToFile(\n            spark.sql(productOrdersQuery(i.toString)),\n            s\"top10_products_by_orders_$i\"\n        )","dateUpdated":"2018-08-23T22:01:27+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535062298135_-1880368635","id":"20180823-221138_765601787","dateCreated":"2018-08-23T22:11:38+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1024","text":"val customerGrossSpendingQuery = n=>s\"select client_id,sum(total) gross_sales from orders where month(timestamp) = $n group by client_id order by gross_sales desc limit 10\"","dateUpdated":"2018-08-23T22:13:05+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535062447782_-850397474","id":"20180823-221407_1043471148","dateCreated":"2018-08-23T22:14:07+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1080","text":"for (i <- 1 to 7)\n    saveToFile(\n            spark.sql(customerGrossSpendingQuery(i.toString)),\n            s\"top10_customers_by_gross_spending_$i\"\n        )","dateUpdated":"2018-08-23T22:14:47+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535062295444_-2126992680","id":"20180823-221135_2100337757","dateCreated":"2018-08-23T22:11:35+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:968","text":"val customerOrdersQuery = n=>s\"select client_id, count(id) orders_count from orders where month(timestamp) = $n group by client_id order by orders_count desc limit 10\"","dateUpdated":"2018-08-23T22:14:07+0000"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1535062487542_1241158844","id":"20180823-221447_635543967","dateCreated":"2018-08-23T22:14:47+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1136","text":"for (i <- 1 to 7)\n    saveToFile(\n            spark.sql(customerOrdersQuery(i.toString)),\n            s\"top10_customers_by_orders_$i\"\n        )","dateUpdated":"2018-08-23T22:15:17+0000"}],"name":"AlimazonC3v2","id":"2DNBU4CR4","angularObjects":{"2DNKYS9A7:shared_process":[],"2DQCWKX5R:shared_process":[],"2DN66H2S9:shared_process":[],"2DNFGRKRE:shared_process":[],"2DR97JNHF:shared_process":[],"2DNQBURZ9:shared_process":[],"2DPBZU179:shared_process":[],"2DNSVWDTF:shared_process":[],"2DQ54CDPD:shared_process":[],"2DNNW6U5P:shared_process":[],"2DPEHYM74:shared_process":[],"2DPT4ECED:shared_process":[],"2DNDX1VKA:shared_process":[],"2DNAA7YCZ:shared_process":[],"2DRG2SA38:shared_process":[],"2DQWV9598:shared_process":[],"2DR5YWSSV:shared_process":[],"2DNSD7N1U:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}